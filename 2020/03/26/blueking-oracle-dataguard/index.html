<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><title>利用蓝鲸标准运维实现Oracle DataGuard一键切换 | 厚诺技术团队</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="honops"><meta name="designer" content="minfive"><meta name="keywords" content="blog, devops, k8s, go, 蓝鲸, 监控, CMDB, ITSM"><meta name="description" content="专注DevOps，智能运维及云服务"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="http://tech.honops.com/2020/03/26/blueking-oracle-dataguard/index.html"><link rel="icon" type="image/png" href="/img/favicon.ico" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="厚诺科技"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?d0e25934bf1ea1aef0e9d8517467221a";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="stylesheet" href="/scss/views/page/post.css"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="厚诺科技" type="application/atom+xml"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(https://blog.static.minfive.com/other/loader.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="厚诺科技" alt="厚诺科技"><img src="/img/logo.png" alt="厚诺科技"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="https://unsplash.sxlcdn.com/photo-1524749292158-7540c2494485?ixlib=rb-1.2.1&q=85&fm=jpg&crop=entropy&cs=srgb&h=1500&w=2000&fit=clip&fm=jpg" alt="利用蓝鲸标准运维实现Oracle DataGuard一键切换"></div><header class="post__info"><h1 class="post__title">利用蓝鲸标准运维实现Oracle DataGuard一键切换</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/">胡坤琦</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2020-03-26</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/%E8%BF%90%E7%BB%B4/">运维</a></li><li class="mark__item"><a href="/tags/oracle/">Oracle</a></li><li class="mark__item"><a href="/tags/%E6%A0%87%E5%87%86%E8%BF%90%E7%BB%B4/">标准运维</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-eye"></i><ul class="mark__list clearfix"><li id="busuanzi_container_page_pv" class="mark__item"><span id="busuanzi_value_page_pv"></span>次</li></ul></div></div></header><div class="post__content"><p>什么是标准运维</p><p>标准运维是一套通过成熟稳定的任务调度引擎，把多系统间的工作整合到一个流程，助力运维实现跨系统调度自动化的’SaaS’应用。标准运维拥有可视化的图形界面，用户可通过它实现任务流程编排和执行，包括发布、变更、开区、扩缩容等执行类操作场景。作为蓝鲸体系中兼顾运维操作和运维流程的标准化、自动化的利器，标准运维通过几大功能点去实现它的价值：</p><p>调度编排服务：基于蓝鲸PaaS平台的API网关服务，不仅集成了腾讯蓝鲸产品各大原子平台的能力；而且能够无侵入地对接企业内部已有系统的功能，将企业内部多系统间的工作整合到一个流程模版中，实现一键自动化调度。<br>自助化服务：标准运维通过与蓝鲸PaaS平台的深度整合，为用户提供了“轻应用”和“职能化”功能，通过有效的权限控制，简化入口通道、操作界面，让用户可以将业务日常的运维工作交给产品和职能化人员执行，实现业务的发布、变更等工作自助化。 Ps：“轻应用”的执行人员，在业务中的角色称为“职能化”人员（区别于“运维人员”、“产品人员”等的一个角色标签）<br>标准插件自主开发：标准插件提供一套完整的开发流程规范，通过丰富的表单界面和验证逻辑将企业内部各个系统、各个平台的API组装成一个标准插件模板。使其他的系统通过标准插件的开发模板来调动不同系统间的功能。<br>蓝鲸标准运维<br>如果说大家对于标准运维还没有深入的认识，别着急，下面小编通过企业内的实际运维场景，带大家认识一下标准运维给日常工作带来哪些便捷，给你不一样的运维体验。</p><p>何为Oracle ADG</p><p>Data guard是ORACLE 推出的一种高可用性(HIGH AVAILABLE)的数据库方案,在8i之前称之为standby database，从9i开始，正式更名为Data guard，它是在主节点与备用节点间通过日志同步来保证数据的同步，可以实现快速切换与灾难性恢复。Data guard只是在软件上对数据库进行设置，并不需要额外购买任何组件能在对主数据库影响很小的情况下，实现主备数据库的同步，而主备机的数据差异只在在线日志部分，所以被不少企业作为了数据容灾方案。Oracle 11g之前的Oracle Data Guard 通过不断地应用来自生产数据库的更改，同步物理备用数据库与相应的生产数据库，以实现数据保护和高可用性，但是必须先停止重做日志的应用才能对备用数据库进行读取。</p><p>Oracle Active Data Guard 是Oracle 11g引入的，允许物理备用数据库打开进行只读访问，包括报告、简单或复杂查询、排序、基于Web 的访问等。同时还可以继续应用来自生产数据库的更改。对物理副本的所有查询读取都是实时执行，并且可以返回最新的数据结果。这意味着，需要进行最新只读访问的所有操作都可以在副本上完成，从而可以确保生产数据库的性能。</p><p>数据库层双活部署目前业界主要有三种方式：A/S（Active-Standby）方式，Oracle RAC集群实（Active-Active）方式和通过第三方数据复制软件方式。基于Oracle ADG技术，采用从主库向备库传输redo日志方式，备库恢复数据过程可以用只读方式打开进行查询操作，实现了部分双活功能，在主节点故障后可以将备节点切为主节点，平实备节点可以提供只读操作。</p><p>oracle dataguard<br>Oracle ADG一般启用场景，包括以下：</p><p>作为应急或容灾：只有生产侧可以读写，容灾侧只读，双活读，非双活读写。按照测试，数据库切换时间在30S左右。</p><p>作为读写分离机制：分摊生产端压力，降低生产负载。<br>- 只读查询业务分离（ADG侧平时运行从生产库迁移过来的查询业务）<br>- 数据库备份（使用RMAN进行全备和归档备份到带库）<br>- 业务数据实时抽取<br>- DB变更前数据库快照备份<br>作为数据保护手段：如在ADG库上启用Flash DB特性，需要时可以执行闪回，以恢复误操作等导致的生产库上的数据丢失。<br>用户需求描述</p><p>用户环境有多套Oracle数据库，为了更好的保障业务系统运行，提高服务质量，先后建立了高可用保障手段、应急容灾系统等保护机制，但灾备应用切换依然依赖手工操作，系统切换需要一系列管理和技术流程，维护复杂，生产、容灾端都需要维护。为了降低人工成本，缩短切换时间，减少人工干预，提高了切换的成功率，提升企业的运维水平和故障应急处理能力。用户迫切需要实现将传统手工流程变为全自动化操作流程，同时满足多个业务系统并发切换，以便在突发灾难等紧急情况下，在灾备环境快速恢复业务。并且灾备切换的范围涵盖企业核心业务系统，以及这些系统依赖的包括UNIX、Windows主机、存储、文件系统、数据库、中间件服务、Web服务器及其他应用服务的切换。并达到以下目标：</p><p>单一Web入口进入灾备自动切换控制台，无需人工逐一登录各主机进行操作；<br>严格的权限控制及操作审计日志；<br>能够根据具体操作流程的要求，以不同用户身份和权限执行指令；<br>能够直观展示切换进度，一旦发生故障可以快速定位；<br>能够根据要求实现切换过程中的人工交互处理<br>实现过程</p><p>首先，可以把Oracle ADG的整个切换过程（switchover）分为：</p><p>主备状态检测<br>主库切换为备库<br>备库切换为主库<br>在新的备库上（原主库）执行启用日志实时应用模式<br>通过标准运维的“分支网关“中分支节点的条件进行判断，确定下一步执行的节点。当执行任务期间如果出现“异常情况”时，则通过分支条件给负责人发送邮件提示，并且暂停任务，通过以上分解的流程编排步骤，实现一键灾备切换。同时，标准运维“并行网关”可以实现流程同步进行，并将通用流程编入“子流程”，结合输入输出参数，实现一次编排，多次使用的效果。</p><p>蓝鲸标准运维实现Oracle dataguard切换<br>上图清晰展示了Oracle ADG的切换过程，当切换过程出现异常情况时，DBA可以立刻收到告警通知介入处理，快速判断并恢复故障。同样，其它Oracle ADG之外的类似灾备切换场景，也可以在以上流程模板的基础上，根据具体环境和场景要求，通过对流程节点的编排和参数调整来轻松实现适配。</p><p>总结</p><p>以上，通过一个在传统IOE场景比较普遍的Oracle ADG切换场景，初步展示了蓝鲸标准运维设计和实现的过程。进一步的，可以把这个场景做进一步的丰富和扩充，比如纳入应用服务器的切换和启停，以及加入不同环节的人工交互处理过程。总之，拥有标准运维这把流程编排的的万能之匙，任何企业的IT部门或运维团队，在面对各种各样的复杂运维流程和场景时，都可以通过标准运维将这些重复性、规律性的手工作业场景，进行灵活的分解、组装和编排，实现并满足企业对运维自动化的需求，并带来显著收益。</p><div class="post-announce">感谢您的阅读，本文由 <a href="http://tech.honops.com">厚诺科技</a> 版权所有。如若转载，请注明出处：厚诺科技（<a href="http://tech.honops.com/2020/03/26/blueking-oracle-dataguard/">http://tech.honops.com/2020/03/26/blueking-oracle-dataguard/</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/2020/03/26/blueking-cd/" title="利用蓝鲸标准运维实现应用自动发布（持续交付）"><i class="iconfont icon-prev"></i>利用蓝鲸标准运维实现应用自动发布（持续交付）</a></div><div class="post__prev post__prev--right"></div></div></div></article><div id="comment-container"></div></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">专注DevOps，智能运维及云服务</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a><span class="block-list-count">3</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2020/03/26/blueking-oracle-dataguard/" title="利用蓝鲸标准运维实现Oracle DataGuard一键切换"><div class="item__cover"><img src="https://unsplash.sxlcdn.com/photo-1524749292158-7540c2494485?ixlib=rb-1.2.1&q=85&fm=jpg&crop=entropy&cs=srgb&h=1500&w=2000&fit=clip&fm=jpg" alt="利用蓝鲸标准运维实现Oracle DataGuard一键切换"></div><div class="item__info"><h3 class="item__title">利用蓝鲸标准运维实现Oracle DataGuard一键切换</h3><span class="item__text">2020-03-26</span></div></a></li><li class="latest-post-item"><a href="/2020/03/26/blueking-cd/" title="利用蓝鲸标准运维实现应用自动发布（持续交付）"><div class="item__cover"><img src="https://unsplash.sxlcdn.com/photo-1423666639041-f56000c27a9a?ixlib=rb-1.2.1&q=85&fm=jpg&crop=entropy&cs=srgb&h=540&w=540&fit=clip&fm=jpg" alt="利用蓝鲸标准运维实现应用自动发布（持续交付）"></div><div class="item__info"><h3 class="item__title">利用蓝鲸标准运维实现应用自动发布（持续交付）</h3><span class="item__text">2020-03-26</span></div></a></li><li class="latest-post-item"><a href="/2020/03/26/blueking-wework/" title="配置企业微信发送蓝鲸告警信息"><div class="item__cover"><img src="https://uploads.sxlcdn.com/static/backgrounds/cityscape/155.jpg" alt="配置企业微信发送蓝鲸告警信息"></div><div class="item__info"><h3 class="item__title">配置企业微信发送蓝鲸告警信息</h3><span class="item__text">2020-03-26</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/oracle/">oracle</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E5%91%8A%E8%AD%A6/">告警</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E6%95%85%E9%9A%9C%E8%87%AA%E6%84%88/">故障自愈</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E6%A0%87%E5%87%86%E8%BF%90%E7%BB%B4/">标准运维</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E8%87%AA%E5%8A%A8%E5%8F%91%E5%B8%83/">自动发布</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E8%BF%90%E7%BB%B4/">运维</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">© 2020 厚诺技术团队 All rights reserved.</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>Zhengzhou, Henan Province, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>tech@honops.com</span></li></ul></div></div><div class="footer-top__item footer__image"><img src="http://user-assets.sxlcdn.com/images/501804/FpWyg-ZoIRsGEYFLSKZseer5H3k_.JPG?imageMogr2/strip/auto-orient/thumbnail/720x1440%3E/quality/90!/interlace/1/format/jpg" alt="logo" title="厚诺科技"></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><ul class="footer__social-network clearfix"></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/md5.min.js"></script><script>var tags=["运维","oracle","标准运维"],gitalk=new Gitalk({clientID:"5e9037d903b1e5ef6be6",clientSecret:"2f92253ec1ea0570ccd2c57f457949bb0ed6b66f",repo:"honops-blog-comment",owner:"honops",admin:["honops"],labels:tags,id:new Date(1585216059e3).getTime()>new Date("2018-02-15").getTime()?md5(location.href):location.href});gitalk.render("comment-container")</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>